{
  "name": "KafkaDemo Development",
  "dockerComposeFile": ["../docker-compose.yml", "docker-compose.devcontainer.yml"],
  "service": "devcontainer",
  "workspaceFolder": "/workspace",
  
  // Features to add
  "features": {
    "ghcr.io/devcontainers/features/dotnet:2": {
      "version": "8.0"
    },
    "ghcr.io/devcontainers/features/docker-in-docker:2": {}
  },

  // Forward ports for development
  "forwardPorts": [
    9092,   // Kafka broker
    8080,   // Kafka UI
    5000,   // .NET API
    5001    // .NET API HTTPS
  ],

  // Port labels for better UX
  "portsAttributes": {
    "9092": {
      "label": "Kafka Broker",
      "onAutoForward": "silent"
    },
    "8080": {
      "label": "Kafka UI",
      "onAutoForward": "openBrowser"
    },
    "5000": {
      "label": ".NET API",
      "onAutoForward": "notify"
    }
  },

  // Run commands after container is created
  "postCreateCommand": "bash .devcontainer/scripts/post-create.sh",
  
  // Run when container starts each time
  "postStartCommand": "bash .devcontainer/scripts/post-start.sh",

  // VS Code extensions to install
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-dotnettools.csdevkit",
        "ms-dotnettools.csharp",
        "ms-azuretools.vscode-docker",
        "humao.rest-client",
        "jeppeandersen.vscode-kafka",
        "eamodio.gitlens"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "editor.formatOnSave": true,
        "dotnet.defaultSolution": "KafkaDemo.sln"
      }
    }
  },

  // Environment variables
  "containerEnv": {
    "KAFKA_BOOTSTRAP_SERVERS": "kafka:29092",
    "ASPNETCORE_ENVIRONMENT": "Development"
  },

  // Run as non-root user for security
  "remoteUser": "vscode"
}
